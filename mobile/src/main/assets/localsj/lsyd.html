<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<link href="css/style.css" rel="stylesheet" type="text/css" />
<title>电费电量</title>
<script>
;(function(win,doc){
	function change(){
		document.documentElement.style.fontSize=document.documentElement.clientWidth/16+'px';
	}

	win.addEventListener('resize',change,false);
	win.addEventListener('DOMContentLoaded',change,false);

})(window,document);

</script>
</head>

<body>
<!--header-->
<div class="head">
	<div class="left_ico"><img src="images/img_03.png" id="fhBtn" /></div>
    <div class="mid">电量电费</div>
    <div class="right_ico"><img src="images/img_06.png"  id="shareBtn"/></div>
</div>

<!--kehuxinxi-->
<div class="khxx">
	<div class="khxx_left">
    	<img src="images/user.png" />
    </div>
    <div class="khxx_rt">
    	<p class="khxx_tit">*号室</p>
        <p class="khbh_bh">客户编号:<span></span></p>
         <p class="dizhi">用电地址:<em id=demo><em id=demo1></em><em id=demo2></em></em></p>
    </div>
</div>

<!--jiejidianliang-->
<div class="dldf_con clearfix">
	<ol class="dldf_btn">
    	<li class="nf1">2014年</li>
        <li class="nf2">2015年</li>
        <li class="nf3 dldf_active">2016年</li>
    </ol>
    <div class="jjdl" >
        	<p class="jjdl_1"><span class="qndl">电量<i>1417</i>度</span><span class="qndf">电费<i>691.92</i>元</span></p>
            <ol class="jjdl_2">
                <li class="jjdl_yj"><span></span>一阶电量</li>
                <li class="jjdl_ej"><span></span>二阶电量</li>
                <li class="jjdl_sj"><span></span>三阶电量</li>
            </ol>
            <ul id="ul1">
             
            </ul>
       
    </div>
    
    <div class="jjdl">
        	<p class="jjdl_1"><span class="qndl1">电量<i>2000</i>度</span><span class="qndf1">电费<i>691.92</i>元</span></p>
            <ol class="jjdl_2">
                <li class="jjdl_yj"><span></span>一阶电量</li>
                <li class="jjdl_ej"><span></span>二阶电量</li>
                <li class="jjdl_sj"><span></span>三阶电量</li>
            </ol>
            <ul id="ul2">
                
            </ul>
       
    </div>
    
    <div class="jjdl" style="display:block;">
        	<p class="jjdl_1"><span class="jndl">电量<i>3000</i>度</span><span class="jndf">电费<i>691.92</i>元</span></p>
            <ol class="jjdl_2">
                <li class="jjdl_yj"><span></span>一阶电量</li>
                <li class="jjdl_ej"><span></span>二阶电量</li>
                <li class="jjdl_sj"><span></span>三阶电量</li>
            </ol>
            <ul id="ul3">
               
            </ul>
       
    </div>
</div>
</body>
</html>
<script src="js/common.js"></script>
<script>
var bridge=null;

var jsonqn="";
var jsonqn2="";
var jsonjn="";

/*年份*/
var d = new Date();
var dqnf=d.getFullYear();
var nf1=document.querySelector('.nf1');
var nf2=document.querySelector('.nf2');
var nf3=document.querySelector('.nf3');

nf3.innerHTML=dqnf+'年';
nf2.innerHTML=dqnf-1+'年';
nf1.innerHTML=dqnf-2+'年';

var fhBtn=document.querySelector("#fhBtn");
var shareBtn=document.querySelector("#shareBtn");

var aBtn=document.querySelectorAll('.dldf_con .dldf_btn li');
var aBox=document.querySelectorAll('.dldf_con .jjdl');
	
	

window.onload = function() {
   if(iosand()!='ios')
   {
	  
	  
	  data='{"order":"getConsInfo"}';
	  window.sgcc.fromJsFunction_init(data);
	  
   }

}
function showJsoninit(str){
	    //第一次获取客户信息
		jsonkhxx=eval('('+str+')');
	
		
}
function showJson(str){
	
		jsonjn=eval('('+str+')');
		showShuju(jsonjn,0);
		
}

function showJson_qn(str){
	//今年0，去年1，前年2
		jsonqn=eval('('+str+')');
		showShuju(jsonqn,1);
		
}

function showJson_qn2(str){
	//今年0，去年1，前年2
		jsonqn2=eval('('+str+')');
		showShuju(jsonqn2,2);
		
}


if(iosand()=='ios')
{
	
	
    document.addEventListener('WebViewJavascriptBridgeReady', onBridgeReady, false)
	function onBridgeReady(event) {
        bridge = event.bridge;
        var uniqueId = 1;
        var data = null;
        
		
		
		
		//第一次请求用户编号
    
		
        bridge.send(data, function (responseData) {
                    });
		
		
		fhBtn.onclick=function(){
		        bridge.callHandler("fromJsFunction_back", 
                 function callback(response) {
	             })
		}
		
		shareBtn.onclick=function(){
		   shareBtn={"title":"下载“掌上电力”，参与有奖活动吧","content":" 掌上电力开展限时优惠活动，数量有限，先到先得，马上行动哟！"};
		   
		    bridge.callHandler("fromJsFunction_share", 
			        shareBtn,
                 function callback(response) {
	             }
            )
		}
		
//去年点击事件		
nf2.onclick=function(){
	
	
	
		
		
			for(var i=0; i<aBtn.length; i++){
				aBtn[i].className='nf'+(i+1);
				aBox[i].style.display='none';
			}
			this.className +=' dldf_active';
			aBox[1].style.display='block';
		
	
	
if(jsonqn=="")		
{
	 bridge.callHandler('fromJsFunction_transfer', 
                 {'requestCode':'GDT09003','versionCode':'1.1','data':{'consNo':parseInt(jsonkhxx["data"]["consNo"]),'lastDate':parseInt((dqnf-1)+'01'),'endDate':parseInt((dqnf-1)+'12')}}, 
                 function callback(response) {
                   
				   jsonqn=eval('('+response+')');
		          
		          showShuju(jsonqn,1);  
	    
			}
        ) 
}
		
			
}
	
	
//前年点击事件		
nf1.onclick=function(){
	
	
		for(var i=0; i<aBtn.length; i++){
				aBtn[i].className='nf'+(i+1);
				aBox[i].style.display='none';
			}
			this.className +=' dldf_active';
			aBox[0].style.display='block';
if(jsonqn2=="")		
{		

	 bridge.callHandler('fromJsFunction_transfer', 
                 {'requestCode':'GDT09003','versionCode':'1.1','data':{'consNo':parseInt(jsonkhxx["data"]["consNo"]),'lastDate':parseInt((dqnf-2)+'01'),'endDate':parseInt((dqnf-2)+'12')}}, 
                 function callback(response) {
                   
				   jsonqn2=eval('('+response+')');
		          
		          showShuju(jsonqn2,2);  
	    
			}
        ) 
}
		
			
}
	
	
//今年点击事件		
nf3.onclick=function(){


	for(var i=0; i<aBtn.length; i++){
				aBtn[i].className='nf'+(i+1);
				aBox[i].style.display='none';
			}
			this.className +=' dldf_active';
			aBox[2].style.display='block';
		
if(jsonjn=="")		
{
	 bridge.callHandler('fromJsFunction_transfer', 
                 {'requestCode':'GDT09003','versionCode':'1.1','data':{'consNo':parseInt(jsonkhxx["data"]["consNo"]),'lastDate':parseInt(dqnf+'01'),'endDate':parseInt(dqnf+'12')}}, 
                 function callback(response) {
                   
				   jsonjn=eval('('+response+')');
		          
		          showShuju(jsonjn,0);  
	    
			}
        ) 
	  	
}
			
}
		
		
		
		bridge.init(function (message, responseCallback) {
                   jsonjn = eval('('+message+')');
                    bridge.callHandler('fromJsFunction_init',
                                       {"order":"getConsInfo"},
                                       function callback(response) {
                                       
                                       jsonkhxx=eval('('+response+')');
                                       
                                       
                                       showShuju(jsonjn,0);
                                }
                        )
                    
		});
	}
	
}else
{
	
	fhBtn.onclick=function(){
		
		window.sgcc.fromJsFunction_back();		
	};
	shareBtn.onclick=function(){
		shareBtn={"title":"下载“掌上电力”，参与有奖活动吧","content":" 掌上电力开展限时优惠活动，数量有限，先到先得，马上行动哟！"};
		window.sgcc.fromJsFunction_share(shareBtn);		
	};
	
	//去年按钮
	nf2.onclick=function(){
		
		for(var i=0; i<aBtn.length; i++){
				aBtn[i].className='nf'+(i+1);
				aBox[i].style.display='none';
			}
			this.className +=' dldf_active';
			aBox[1].style.display='block';

if(jsonqn=="")		
{	 
	 var data='{"requestCode":"GDT09003","versionCode":"1.1","data":{"consNo":'+jsonkhxx["data"]["consNo"]+',"lastDate":'+parseInt((dqnf-1)+'01')+',"endDate":'+parseInt((dqnf-1)+'12')+'}}';
	  window.sgcc.fromJsFunction_transfer(data,'showJson_qn');	
}
			
};
	
	
	//前年按钮
	nf1.onclick=function(){
		
		for(var i=0; i<aBtn.length; i++){
				aBtn[i].className='nf'+(i+1);
				aBox[i].style.display='none';
			}
			this.className +=' dldf_active';
			aBox[0].style.display='block';

if(jsonqn2=="")		
{	 
	 var data='{"requestCode":"GDT09003","versionCode":"1.1","data":{"consNo":'+jsonkhxx["data"]["consNo"]+',"lastDate":'+parseInt((dqnf-2)+'01')+',"endDate":'+parseInt((dqnf-2)+'01')+'}}';
	  window.sgcc.fromJsFunction_transfer(data,'showJson_qn2');	
		
}			
};
	
	//今年按钮
	nf3.onclick=function(){
		
		for(var i=0; i<aBtn.length; i++){
				aBtn[i].className='nf'+(i+1);
				aBox[i].style.display='none';
			}
			this.className +=' dldf_active';
			aBox[2].style.display='block';
if(jsonjn=="")		
{	 
	 var data='{"requestCode":"GDT09003","versionCode":"1.1","data":{"consNo":'+jsonkhxx["data"]["consNo"]+',"lastDate":'+parseInt((dqnf-1)+'01')+',"endDate":'+parseInt((dqnf-1)+'12')+'}}';
	  window.sgcc.fromJsFunction_transfer(data,'showJson');	
		
}
};
	
	
	
} 


			
function showShuju(json,nf){
    
var json2=jsonkhxx['data'];
//alert(json["data"]["requestCode"]);
var yyName=document.querySelector('.khxx_tit');
	var oKhbh=document.querySelector('.khbh_bh span');
	var address=document.querySelector('.dizhi #demo1');
    yyName.innerHTML='*'+json2['consName'].substring(1);
	oKhbh.innerHTML=json2["consNo"];
	address.innerHTML=json2["addr"].substring(0,4)+'******'+json2["addr"].substring(json2["addr"].length-4)+'。';
	
	//地址运动
  var speed=50
  demo2.innerHTML=demo1.innerHTML
  function Marquee(){
  if(demo2.offsetWidth-demo.scrollLeft<=0)
  demo.scrollLeft-=demo1.offsetWidth
  else{
  demo.scrollLeft++
  }
  }
  var MyMar=setInterval(Marquee,speed)
  demo.onmouseover=function() {clearInterval(MyMar)}
  demo.onmouseout=function() {MyMar=setInterval(Marquee,speed)}			
			
			
    if(nf==1)
    {
        var arrlast=json["data"]["quantityList"]["quantity"];//去年
        month("ul2","qndl1","qndf1",arrlast);
    }
    else if(nf==2)
    {
        var arrqian=json["data"]["quantityList"]["quantity"];//前年
        month("ul1","qndl","qndf",arrqian);
    }
    else
    {
        var arr=json["data"]["quantityList"]["quantity"];
        month("ul3","jndl","jndf",arr);
    }

			
			
//var arr=json["data"]["returnContent"]["data"]["quantityList"]["quantity"];//今年
//var arrlast=json["quantityList"]["Quantitylast"];//去年
//var arrqian=json["quantityList"]["Quantityqian"];//前年
//month("ul1","qndl","qndf",arrqian);
//month("ul2","qndl1","qndf1",arrlast);
//month("ul3","jndl","jndf",arr);

}


function month(id,dl,df,arr){
	
	var nid=0;
	if(id=='ul3')
	{
		nid=dqnf;
	}
	else if(id=='ul2')
	{
		nid=dqnf-1;
	}
	else if(id=='ul1')
	{
		nid=dqnf-2;
	}
	
	var oUl=document.getElementById(id);
	var odl=document.querySelector('.'+dl+' i');
	var odf=document.querySelector('.'+df+' i');
	
	var dl=0;
	var df=0;
	for(var i=0; i<arr.length; i++){
		var oLi=document.createElement('li');
		if(arr[i]["quantityLevel"]==1){
			oLi.className="jjdl_yijie";
		}else if(arr[i]["quantityLevel"]==2){
			oLi.className="jjdl_yijie jjdl_erjie";
		}else if(arr[i]["quantityLevel"]==3){
			oLi.className="jjdl_yijie jjdl_sjie";
		}
		else if(arr[i]["quantityLevel"]==0){
			oLi.className="jjdl_yijie jjdl_yino";
		}
		
		/*else if(arr[i]["quantityLevel"]==0){
			oLi.className="jjdl_yijie jjdl_yino";
		}*/
		dl=dl+Number(arr[i]["monthQuantity"]);
		df=df+Number(arr[i]["monthElectricity"]);
		
		if(arr[i]["quantityLevel"]==0)
		{
			oLi.innerHTML='<h2>'+arr[i]["month"]+'月</h2>'+
					'<div class="jjdl_yjyf">'+
						
					'</div>';
		}
		else
		{
			oLi.innerHTML='<h2>'+arr[i]["month"]+'月</h2>'+
					'<div class="jjdl_yjyf" onclick="showYdxq('+arr[i]["month"]+')">'+
						'<p><img src="images/ico_03.png" /><span>'+arr[i]["monthElectricity"]+'</span>元</p>'+
						'<p><img src="images/ico_07.png" /><span>'+arr[i]["monthQuantity"]+'</span>kWh</p>'+
					'</div>';
		}
		
		oUl.appendChild(oLi);	
		
	};
	
	odl.innerHTML=dl;
	odf.innerHTML=df;
	
	
	
	if(arr.length<12){	
		for(var k=arr.length+1; k<=12; k++){
			var oLi=document.createElement('li');
			oLi.className="jjdl_yijie jjdl_yino";
			oLi.innerHTML='<h2>'+toDou(k)+'月</h2>'+
						'<div class="jjdl_yjyf">'+
							
						'</div>';
			oUl.appendChild(oLi);
		}
	}
	
	
	
	//var aBtn=document.querySelectorAll('.dldf_con .dldf_btn li');
//	var aBox=document.querySelectorAll('.dldf_con .jjdl');
//	
//	for(var i=0; i<aBtn.length; i++){
//		aBtn[i].index=i;
//		aBtn[i].onclick=function(){
//			for(var i=0; i<aBtn.length; i++){
//				aBtn[i].className='nf'+(i+1);
//				aBox[i].style.display='none';
//			}
//			this.className +=' dldf_active';
//			aBox[this.index].style.display='block';
//		}
//	}
	
}

	
	
	function toDou(n){
		return n<10 ? "0"+n : ""+n;
	}
	function showYdxq(yuefen){
		if(iosand()=='ios')
        {
			alert(yuefen)
			
				anyBtn1=document.querySelector('.khbh_bh span').innerHTML;
				
				
				anyBtn={"type":3,"url":"ydxq.html","param":{"requestCode":"GDT08099","versionCode":"1.1","data":{"consNo":anyBtn1,"bgnDate":yuefen,"endDate":yuefen}}}
			bridge.callHandler('fromJsFunction_jump', 
                 anyBtn,
                 function callback(response) {
              
	             })	
		
		}
		else
		{
			
			anyBtn1=document.querySelector('.khbh_bh span').innerHTML;
			anyBtn='{"type":3,"url":"ydxq.html","param":{"requestCode":"GDT08099","versionCode":"1.1","data":{"consNo":'+anyBtn1+',"bgnDate":'+yuefen+',"endDate":'+yuefen+'}}}'
		
		window.sgcc.fromJsFunction_jump(anyBtn);
			
			
				
		}
		
	}
	
</script>
